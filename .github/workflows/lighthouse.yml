name: Lighthouse CI - Mobile & Desktop
on: 
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  lighthouse-mobile:
    name: ðŸ“± Lighthouse Mobile
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Run Lighthouse CI - Mobile
        id: lighthouse-mobile
        uses: treosh/lighthouse-ci-action@v12
        with:
          urls: |
            https://dhaneshbb.github.io
            https://dhaneshbb.github.io/about.html
            https://dhaneshbb.github.io/projects.html
            https://dhaneshbb.github.io/experience.html
            https://dhaneshbb.github.io/contact.html
          uploadArtifacts: true
          temporaryPublicStorage: true
          runs: 3
          
      - name: Print Mobile Report Links
        run: |
          echo "ðŸ”— MOBILE LIGHTHOUSE REPORT LINKS"
          echo "=================================="
          echo ""
          echo "ðŸ“± All mobile reports are available in the action output above"
          echo "ðŸ“± Check the 'Run Lighthouse CI - Mobile' step for individual page links"
          echo ""
          echo "=================================="

  lighthouse-desktop:
    name: ðŸ’» Lighthouse Desktop  
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Run Lighthouse CI - Desktop
        id: lighthouse-desktop
        uses: treosh/lighthouse-ci-action@v12
        with:
          urls: |
            https://dhaneshbb.github.io
            https://dhaneshbb.github.io/about.html
            https://dhaneshbb.github.io/projects.html
            https://dhaneshbb.github.io/experience.html
            https://dhaneshbb.github.io/contact.html
          uploadArtifacts: true
          temporaryPublicStorage: true
          runs: 3
          configPath: './lighthouserc-desktop.json'
          
      - name: Create Desktop Config
        run: |
          cat > lighthouserc-desktop.json << 'EOF'
          {
            "ci": {
              "collect": {
                "settings": {
                  "preset": "desktop"
                }
              },
              "upload": {
                "target": "temporary-public-storage"
              }
            }
          }
          EOF
          
      - name: Run Lighthouse CI - Desktop (with config)
        uses: treosh/lighthouse-ci-action@v12
        with:
          urls: |
            https://dhaneshbb.github.io
            https://dhaneshbb.github.io/about.html
            https://dhaneshbb.github.io/projects.html
            https://dhaneshbb.github.io/experience.html
            https://dhaneshbb.github.io/contact.html
          uploadArtifacts: true
          temporaryPublicStorage: true
          runs: 3
          configPath: './lighthouserc-desktop.json'
          
      - name: Print Desktop Report Links
        run: |
          echo "ðŸ”— DESKTOP LIGHTHOUSE REPORT LINKS"
          echo "==================================="
          echo ""
          echo "ðŸ’» All desktop reports are available in the action output above"
          echo "ðŸ’» Check the 'Run Lighthouse CI - Desktop' steps for individual page links"
          echo ""
          echo "==================================="

  print-summary:
    name: ðŸ“‹ Report Summary
    runs-on: ubuntu-latest
    needs: [lighthouse-mobile, lighthouse-desktop]
    if: always()
    steps:
      - name: Print Complete Summary
        run: |
          echo "ðŸŽ¯ LIGHTHOUSE REPORTS COMPLETE"
          echo "=============================="
          echo ""
          echo "âœ… Mobile testing: Check ðŸ“± Lighthouse Mobile job"
          echo "âœ… Desktop testing: Check ðŸ’» Lighthouse Desktop job"
          echo ""
          echo "ðŸ“Š TO VIEW REPORTS:"
          echo "1. Click on each job above"
          echo "2. Expand the Lighthouse CI steps"
          echo "3. Look for 'View report at:' links"
          echo "4. Click links to view detailed reports"
          echo ""
          echo "â¬‡ï¸ DOWNLOAD ARTIFACTS:"
          echo "- Scroll up to see 'Artifacts' section"
          echo "- Download lighthouse reports zip files"
          echo ""
          echo "=============================="